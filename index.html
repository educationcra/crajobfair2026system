<!DOCTYPE html>
<html lang="th">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRA Job Fair 2026</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-solid-straight/css/uicons-solid-straight.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-bold-rounded/css/uicons-bold-rounded.css'>
  
  <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.11/dist/dotlottie-wc.js" type="module"></script>
  
  <style>
    body { font-family: 'Prompt', sans-serif; overflow-x: hidden; }
    
    /* ปรับแต่ง SweetAlert ให้ใช้ฟอนต์ Prompt */
    div:where(.swal2-container) { font-family: 'Prompt', sans-serif !important; }
    div:where(.swal2-popup) { border-radius: 20px !important; }

   .checkbox-wrapper-12 { position: relative; display: inline-block; vertical-align: middle; margin-right: 8px; }
    .checkbox-wrapper-12 > svg { position: absolute; top: -130%; left: -170%; width: 110px; pointer-events: none; }
    .checkbox-wrapper-12 * { box-sizing: border-box; }
    .checkbox-wrapper-12 input[type="checkbox"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; -webkit-tap-highlight-color: transparent; cursor: pointer; margin: 0; }
    .checkbox-wrapper-12 input[type="checkbox"]:focus { outline: 0; }
    /* แก้ไขตำแหน่ง Checkbox ให้อยู่ตรงกลาง (แก้ top/left) */
    .checkbox-wrapper-12 .cbx { width: 24px; height: 24px; position: relative; }
    .checkbox-wrapper-12 .cbx input { position: absolute; top: 0; left: 0; width: 24px; height: 24px; border: 2px solid #bfbfc0; border-radius: 50%; }
    .checkbox-wrapper-12 .cbx label { width: 24px; height: 24px; background: none; border-radius: 50%; position: absolute; top: 0; left: 0; transform: trasnlate3d(0, 0, 0); pointer-events: none; }
    .checkbox-wrapper-12 .cbx svg { position: absolute; top: 5px; left: 4px; z-index: 1; pointer-events: none; }
    .checkbox-wrapper-12 .cbx svg path { stroke: #fff; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; stroke-dasharray: 19; stroke-dashoffset: 19; transition: stroke-dashoffset 0.3s ease; transition-delay: 0.2s; }
    .checkbox-wrapper-12 .cbx input:checked + label { animation: splash-12 0.6s ease forwards; }
    .checkbox-wrapper-12 .cbx input:checked + label + svg path { stroke-dashoffset: 0; }

    /* Animation Keyframes (Orange Theme) */
    @-moz-keyframes splash-12 {
      40% { background: #f97316; box-shadow: 0 -18px 0 -8px #f97316, 16px -8px 0 -8px #f97316, 16px 8px 0 -8px #f97316, 0 18px 0 -8px #f97316, -16px 8px 0 -8px #f97316, -16px -8px 0 -8px #f97316; }
      100% { background: #f97316; box-shadow: 0 -36px 0 -10px transparent, 32px -16px 0 -10px transparent, 32px 16px 0 -10px transparent, 0 36px 0 -10px transparent, -32px 16px 0 -10px transparent, -32px -16px 0 -10px transparent; }
    }
    @-webkit-keyframes splash-12 {
      40% { background: #f97316; box-shadow: 0 -18px 0 -8px #f97316, 16px -8px 0 -8px #f97316, 16px 8px 0 -8px #f97316, 0 18px 0 -8px #f97316, -16px 8px 0 -8px #f97316, -16px -8px 0 -8px #f97316; }
      100% { background: #f97316; box-shadow: 0 -36px 0 -10px transparent, 32px -16px 0 -10px transparent, 32px 16px 0 -10px transparent, 0 36px 0 -10px transparent, -32px 16px 0 -10px transparent, -32px -16px 0 -10px transparent; }
    }
    @keyframes splash-12 {
      40% { background: #f97316; box-shadow: 0 -18px 0 -8px #f97316, 16px -8px 0 -8px #f97316, 16px 8px 0 -8px #f97316, 0 18px 0 -8px #f97316, -16px 8px 0 -8px #f97316, -16px -8px 0 -8px #f97316; }
      100% { background: #f97316; box-shadow: 0 -36px 0 -10px transparent, 32px -16px 0 -10px transparent, 32px 16px 0 -10px transparent, 0 36px 0 -10px transparent, -32px 16px 0 -10px transparent, -32px -16px 0 -10px transparent; }
    }
    /* Animation Background */
    @keyframes floatUp {
        0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
        10% { opacity: 0.15; }
        80% { opacity: 0.15; }
        100% { transform: translateY(-20vh) rotate(20deg); opacity: 0; }
    }
    .bg-icon-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
    .floating-icon { position: absolute; top: 0; color: white; opacity: 0; animation: floatUp linear infinite; line-height: 1; }
    
    /* Utility Styles */
    .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); position: relative; z-index: 10; border-radius: 2.5rem; }
    .btn-gradient { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; transition: all 0.3s; }
    .btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(249, 115, 22, 0.3); }
    .input-glass { background-color: #f9fafb; border: 1px solid #e5e7eb; transition: all 0.3s; }
    .input-glass:focus { background-color: #fff; border-color: #f97316; box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.1); outline: none; }

    /* Page Switching Logic */
    .page-section { display: none; animation: fadeIn 0.4s ease-in-out; }
    .page-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .hidden { display: none !important; }
/* --- CSS Loader Animation (ย่อขนาดให้พอดีปุ่ม) --- */
.loader {
  width: 22.4px;
  height: 22.4px;
  color: #ffffff; /* เปลี่ยนเป็นสีขาวให้เข้ากับปุ่มส้ม */
  position: relative;
  background: radial-gradient(5.6px, currentColor 94%, #0000);
}

.loader:before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: 
    radial-gradient(5.04px at bottom right, #0000 94%, currentColor) top left,
    radial-gradient(5.04px at bottom left, #0000 94%, currentColor) top right,
    radial-gradient(5.04px at top right, #0000 94%, currentColor) bottom left,
    radial-gradient(5.04px at top left, #0000 94%, currentColor) bottom right;
  background-size: 11.2px 11.2px;
  background-repeat: no-repeat;
  animation: loader 1.5s infinite cubic-bezier(0.3, 1, 0, 1);
}

@keyframes loader {
  33% {
    inset: -5.6px;
    transform: rotate(0deg);
  }
  66% {
    inset: -5.6px;
    transform: rotate(90deg);
  }
  100% {
    inset: 0;
    transform: rotate(90deg);
  }
}

  </style>
</head>
<body class="bg-gradient-to-br from-orange-500 via-red-500 to-rose-600 min-h-screen relative selection:bg-orange-200 selection:text-orange-900 flex flex-col items-center justify-center p-4">

  <div class="bg-icon-container">
      <i class="fi fi-sr-graduation-cap floating-icon text-9xl" style="left: 5%; animation-duration: 20s;"></i>
      <i class="fi fi-sr-coins floating-icon text-8xl" style="left: 20%; animation-duration: 25s; animation-delay: 5s;"></i>
      <i class="fi fi-sr-analyse-alt floating-icon text-9xl" style="left: 35%; animation-duration: 22s; animation-delay: 2s;"></i>
      <i class="fi fi-sr-carrot floating-icon text-8xl" style="left: 50%; animation-duration: 28s; animation-delay: 8s;"></i>
      <i class="fi fi-sr-microchip floating-icon text-9xl" style="left: 65%; animation-duration: 24s; animation-delay: 1s;"></i>
      <i class="fi fi-sr-stethoscope floating-icon text-8xl" style="left: 80%; animation-duration: 26s; animation-delay: 6s;"></i>
      <i class="fi fi-sr-heart floating-icon text-8xl" style="left: 15%; animation-duration: 23s; animation-delay: 12s;"></i>
      <i class="fi fi-sr-ambulance floating-icon text-9xl" style="left: 90%; animation-duration: 29s; animation-delay: 3s;"></i>
  </div>

  <div class="w-full max-w-4xl relative z-10">
      
      <div id="home" class="page-section active">
         <div class="glass-panel p-8 md:p-12 text-center flex flex-col items-center gap-6">
            
            <div class="mb-4">
                <div class="inline-flex items-center justify-center p-4 bg-white rounded-2xl shadow-lg mb-4 transform -rotate-3 hover:rotate-0 transition">
                    <svg class="w-12 h-12 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
                </div>
                <h1 class="text-4xl md:text-6xl font-bold text-gray-800 tracking-tight leading-tight">
                    CRA JOB FAIR &<br/>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-600">EDUCATION 2026</span>
                </h1>
                <p class="text-gray-500 text-lg mt-4 max-w-lg mx-auto">
                    นิทรรศการแนะแนวอาชีพและการศึกษาต่อราชวิทยาลัยจุฬาภรณ์<br>
                    ลงทะเบียนร่วมงาน รับสิทธิ์คูปองอาหารฟรี! จำนวนจำกัด!
                </p>
            </div>

<div class="relative w-96 h-96 md:w-[500px] md:h-[300px] my-2">
    <dotlottie-wc src="https://lottie.host/ef534813-19b0-4679-903d-4790b0d4ee40/JkiBf0lw92.lottie" autoplay loop class="w-full h-full"></dotlottie-wc>
</div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-lg mt-4">
                <button onclick="startRegister()" class="btn-gradient relative overflow-hidden rounded-2xl p-5 group cursor-pointer border-0">
                    <div class="relative z-10 flex items-center justify-center gap-3">
                        <i class="fi fi-sr-edit text-2xl"></i>
                        <div class="text-left">
                            <span class="block text-xs uppercase opacity-80 font-bold tracking-wider">สำหรับผู้มาใหม่</span>
                            <span class="block text-xl font-bold">ลงทะเบียนเข้างาน</span>
                        </div>
                    </div>
                    <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition duration-300"></div>
                </button>

                <button onclick="startLogin()" class="bg-white border-2 border-orange-100 text-orange-600 rounded-2xl p-5 hover:bg-orange-50 hover:border-orange-200 transition duration-300 flex items-center justify-center gap-3 cursor-pointer shadow-sm hover:shadow-md">
                    <i class="fi fi-sr-user text-2xl"></i>
                    <div class="text-left">
                        <span class="block text-xs uppercase text-gray-400 font-bold tracking-wider">มีบัญชีแล้ว</span>
                        <span class="block text-xl font-bold">เข้าสู่ระบบ</span>
                    </div>
                </button>
            </div>

            <p class="text-xs text-gray-400 mt-8">© 2026 Chulabhorn Royal Academy | by.Chanon jeera</p>
         </div>
      </div>

      <div id="register" class="page-section">
         
         <button id="topBackButton" onclick="goBackToHome()" class="mb-4 flex items-center gap-2 text-white/90 hover:text-white transition font-medium z-30 relative active:scale-95 transition-transform bg-black/20 px-4 py-2 rounded-full backdrop-blur-sm self-start">
            <i class="fi fi-sr-arrow-small-left text-xl mt-1"></i> ย้อนกลับหน้าแรก
         </button>

         <div class="glass-panel w-full p-6 md:p-10 overflow-visible transition-all duration-300">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-orange-400 via-red-500 to-rose-500 rounded-t-[2rem]"></div>

            <div id="formStepper" class="mb-10 px-4 relative z-10">
                <div class="flex items-center justify-between relative max-w-lg mx-auto">
                    <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-full h-1 bg-gray-200 rounded-full -z-10"></div>
                    <div class="absolute left-0 top-1/2 transform -translate-y-1/2 h-1 bg-orange-500 rounded-full transition-all duration-500 shadow-[0_0_10px_rgba(249,115,22,0.5)]" id="progressBar" style="width: 0%;"></div>
                    
                    <div class="flex flex-col items-center gap-2">
                        <div id="stepDot1" class="w-10 h-10 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold shadow-lg ring-4 ring-white transition-all transform scale-110">1</div>
                        <span class="text-xs font-semibold text-gray-600">ข้อมูลส่วนตัว</span>
                    </div>
                    
                    <div class="flex flex-col items-center gap-2">
                        <div id="stepDot2" class="w-10 h-10 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center font-bold ring-4 ring-white transition-all">2</div>
                        <span class="text-xs font-medium text-gray-400">ยืนยัน & ติดต่อ</span>
                    </div>
                </div>
            </div>

            <form id="regForm" onsubmit="handleFormSubmit(event)" class="space-y-8 relative z-20">
                
                <div id="step1" class="animate-fade-in relative">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2 border-l-4 border-orange-500 pl-3">
                        ข้อมูลผู้ลงทะเบียน
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6">
                        <div class="md:col-span-3">
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-sr-venus-mars text-gray-400 mr-1.5 align-middle text-lg"></i>คำนำหน้า <span class="text-red-500">*</span>
                            </label>
                            <select name="prefix" class="w-full input-glass rounded-xl p-3.5 text-gray-700 transition active:scale-[0.98]" required>
                                <option value="">เลือก</option>
                                <option value="นาย">นาย</option>
                                <option value="นาง">นาง</option>
                                <option value="นางสาว">นางสาว</option>
                            </select>
                        </div>
                        <div class="md:col-span-5">
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-br-circle-user text-gray-400 mr-1.5 align-middle text-lg"></i>ชื่อจริง <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="fname" class="w-full input-glass rounded-xl p-3.5 transition focus:scale-[1.01]" required>
                        </div>
                        <div class="md:col-span-4">
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-rr-signature text-gray-400 mr-1.5 align-middle text-lg"></i>นามสกุล <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="lname" class="w-full input-glass rounded-xl p-3.5 transition focus:scale-[1.01]" required>
                        </div>
                    </div>

                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fi fi-sr-id-badge text-gray-400 mr-1.5 align-middle text-lg"></i>สถานะของคุณ <span class="text-red-500">*</span>
                    </label>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6 relative z-10">
                        <label class="cursor-pointer relative group h-full block">
                            <input type="radio" name="userType" value="1.นักศึกษาและบุคลากรราชวิทยาลัยจุฬาภณ์" class="peer sr-only" onchange="toggleFields()" required>
                            <div class="border border-gray-200 rounded-2xl p-4 flex flex-col items-center justify-center text-center gap-2 transition-all duration-200 ease-in-out bg-white hover:border-orange-300 hover:shadow-lg hover:-translate-y-1 active:scale-95 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 h-full">
                                <div class="w-12 h-12 rounded-full bg-gray-50 text-orange-500 flex items-center justify-center mb-1 icon-color shrink-0">
                                    <i class="fi fi-sr-graduation-cap text-xl flex items-center justify-center leading-none"></i>
                                </div>
                                <span class="text-xs font-semibold text-gray-700">นักศึกษาและบุคลากร CRA</span>
                                <div class="absolute top-2 right-2 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                            </div>
                        </label>
                        <label class="cursor-pointer relative group h-full block">
                            <input type="radio" name="userType" value="2.นักศึกษา" class="peer sr-only" onchange="toggleFields()">
                            <div class="border border-gray-200 rounded-2xl p-4 flex flex-col items-center justify-center text-center gap-2 transition-all duration-200 ease-in-out bg-white hover:border-orange-300 hover:shadow-lg hover:-translate-y-1 active:scale-95 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 h-full">
                                <div class="w-12 h-12 rounded-full bg-gray-50 text-orange-500 flex items-center justify-center mb-1 icon-color shrink-0">
                                    <i class="fi fi-sr-backpack text-xl flex items-center justify-center leading-none"></i>
                                </div>
                                <span class="text-xs font-semibold text-gray-700">นักศึกษา</span>
                                <div class="absolute top-2 right-2 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                            </div>
                        </label>
                        <label class="cursor-pointer relative group h-full block">
                            <input type="radio" name="userType" value="3.อาจารย์และนักวิชาการ" class="peer sr-only" onchange="toggleFields()">
                            <div class="border border-gray-200 rounded-2xl p-4 flex flex-col items-center justify-center text-center gap-2 transition-all duration-200 ease-in-out bg-white hover:border-orange-300 hover:shadow-lg hover:-translate-y-1 active:scale-95 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 h-full">
                                <div class="w-12 h-12 rounded-full bg-gray-50 text-orange-500 flex items-center justify-center mb-1 icon-color shrink-0">
                                    <i class="fi fi-sr-chalkboard-user text-xl flex items-center justify-center leading-none"></i>
                                </div>
                                <span class="text-xs font-semibold text-gray-700">อาจารย์และนักวิชาการ</span>
                                <div class="absolute top-2 right-2 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                            </div>
                        </label>
                        <label class="cursor-pointer relative group h-full block">
                            <input type="radio" name="userType" value="4.ประชาชนทั่วไป" class="peer sr-only" onchange="toggleFields()">
                            <div class="border border-gray-200 rounded-2xl p-4 flex flex-col items-center justify-center text-center gap-2 transition-all duration-200 ease-in-out bg-white hover:border-orange-300 hover:shadow-lg hover:-translate-y-1 active:scale-95 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 h-full">
                                <div class="w-12 h-12 rounded-full bg-gray-50 text-orange-500 flex items-center justify-center mb-1 icon-color shrink-0">
                                    <i class="fi fi-sr-users text-xl flex items-center justify-center leading-none"></i>
                                </div>
                                <span class="text-xs font-semibold text-gray-700">ประชาชนทั่วไป</span>
                                <div class="absolute top-2 right-2 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                            </div>
                        </label>
                    </div>

                    <div id="dynamicFields" class="bg-white/60 border border-orange-100 rounded-2xl p-6 mb-6 hidden backdrop-blur-sm relative z-30 shadow-sm">
                         
                         <div id="field-cra-type" class="hidden animate-fade-in mb-4 relative z-[60]">
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-sr-building text-gray-400 mr-1.5 align-middle text-lg"></i>ประเภทในราชวิทยาลัยจุฬาภรณ์ <span class="text-red-500">*</span>
                            </label>
                            <input type="hidden" name="craType" id="craTypeInput">
                            
                            <div id="craTypeTrigger" onclick="toggleCRADropdown()" class="w-full bg-white border border-gray-300 rounded-xl p-3.5 flex justify-between items-center cursor-pointer hover:border-orange-500 hover:ring-2 hover:ring-orange-100 transition shadow-sm relative active:scale-[0.98]">
                                <span id="craTypeDisplayText" class="text-gray-500">-- เลือกประเภท --</span>
                                <i class="fi fi-sr-angle-small-down text-xl text-gray-400 transition-transform duration-300" id="craTypeArrow"></i>
                            </div>
                            <div id="craTypeOptions" class="hidden absolute top-full left-0 w-full mt-2 bg-white rounded-xl shadow-2xl border border-orange-100 overflow-hidden z-[70] origin-top transform transition-all"></div>
                         </div>

                         <div id="field-student-id" class="hidden mb-4 animate-fade-in">
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-sr-id-card-clip-alt text-gray-400 mr-1.5 align-middle text-lg"></i>รหัสนักศึกษา (7 หลัก) <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="studentId" maxlength="7" oninput="this.value = this.value.replace(/[^0-9]/g, '')" class="w-full input-glass rounded-xl p-3" placeholder="xxxxxxx">
                         </div>

                        <div id="field-curriculum" class="hidden mb-4 animate-fade-in relative z-50">
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-sr-book-alt text-gray-400 mr-1.5 align-middle text-lg"></i>หลักสูตร <span class="text-red-500">*</span>
                            </label>
                            <input type="hidden" name="curriculum" id="curriculumInput">
                            
                            <div id="curriculumTrigger" onclick="toggleCurriculumDropdown()" class="w-full bg-white border border-gray-300 rounded-xl p-3.5 flex justify-between items-center cursor-pointer hover:border-orange-500 hover:ring-2 hover:ring-orange-100 transition shadow-sm relative active:scale-[0.98]">
                                <span id="curriculumTriggerText" class="text-gray-500">-- เลือกหลักสูตร --</span>
                                <i class="fi fi-sr-angle-small-down text-xl text-gray-400 transition-transform duration-300" id="curriculumArrow"></i>
                            </div>
                            <div id="curriculumOptions" class="hidden absolute top-full left-0 w-full mt-2 bg-white rounded-xl shadow-2xl border border-orange-100 overflow-hidden max-h-[350px] overflow-y-auto z-[60] origin-top transform transition-all"></div>
                        </div>

                        <div id="field-year" class="hidden mb-4 animate-fade-in">
                            <label class="block text-sm font-medium mb-1">
                                <i class="fi fi-rr-layers text-gray-400 mr-1.5 align-middle text-lg"></i>ชั้นปี <span class="text-red-500">*</span>
                            </label>
                            <select name="year" id="yearSelect" class="w-full input-glass rounded-xl p-3"><option value="">เลือกชั้นปี</option></select>
                        </div>

                        <div id="field-institution" class="hidden mb-4 animate-fade-in">
                            <label class="block text-sm font-medium mb-1">
                                <i class="fi fi-sr-school text-gray-400 mr-1.5 align-middle text-lg"></i>สถาบันการศึกษา <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="institution" class="w-full input-glass rounded-xl p-3">
                        </div>
                        
                        <div id="field-gen-student-info" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 animate-fade-in">
                            <div><label class="block text-sm font-medium mb-1 text-gray-700"><i class="fi fi-sr-diploma text-gray-400 mr-1.5 align-middle text-lg"></i>คณะ/สาขาวิชา <span class="text-red-500">*</span></label><input type="text" name="genCurriculum" class="w-full input-glass rounded-xl p-3" placeholder="ระบุคณะหรือสาขาวิชา"></div>
                            <div><label class="block text-sm font-medium mb-1 text-gray-700"><i class="fi fi-sr-layer-group text-gray-400 mr-1.5 align-middle text-lg"></i>ชั้นปี <span class="text-red-500">*</span></label><select name="genYear" class="w-full input-glass rounded-xl p-3"><option value="">เลือกชั้นปี</option><option value="ปี 1">ชั้นปีที่ 1</option><option value="ปี 2">ชั้นปีที่ 2</option><option value="ปี 3">ชั้นปีที่ 3</option><option value="ปี 4">ชั้นปีที่ 4</option></select></div>
                        </div>

                        <div id="field-workplace" class="hidden mb-4 animate-fade-in">
                            <label class="block text-sm font-medium mb-1">
                                <i class="fi fi-sr-briefcase text-gray-400 mr-1.5 align-middle text-lg"></i>สถานที่ทำงานในปัจจุบัน <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="workplace" class="w-full input-glass rounded-xl p-3">
                        </div>
                        
                        <div id="field-department" class="hidden mb-4 animate-fade-in">
                            <label class="block text-sm font-medium mb-1">
                                <i class="fi fi-sr-structure text-gray-400 mr-1.5 align-middle text-lg"></i>สังกัด <span class="text-red-500">*</span>
                            </label>
                            <select name="department" class="w-full input-glass rounded-xl p-3">
                                <option value="">-- เลือกสังกัด --</option>
                                <option value="สำนักงานราชวิทยาลัยจุฬาภรณ์">สำนักงานราชวิทยาลัยจุฬาภรณ์</option>
                                <option value="โรงพยาบาลจุฬาภรณ์">โรงพยาบาลจุฬาภรณ์</option>
                                <option value="คณะแพทยศาสตรศรีสวางควัฒน">คณะแพทยศาสตรศรีสวางควัฒน</option>
                                <option value="คณะพยาบาลอัครราชกุมารี">คณะพยาบาลอัครราชกุมารี</option>
                                <option value="คณะเทคโนโลยีวิทยาศาสตร์สุขภาพ">คณะเทคโนโลยีวิทยาศาสตร์สุขภาพ</option>
                                <option value="คณะวิทยาศาสตร์">คณะวิทยาศาสตร์</option>
                                <option value="โครงการจัดตั้งคณะวิศวกรรมศาสตร์">โครงการจัดตั้งคณะวิศวกรรมศาสตร์</option>
                                <option value="โครงการจัดตั้งนวัตกรรมอาหารและโภชนาการ">โครงการจัดตั้งนวัตกรรมอาหารและโภชนาการ</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-6 relative z-20"> 
                        <h3 class="text-sm font-semibold text-gray-700 mb-3">
                            <i class="fi fi-sr-calendar-clock text-gray-400 mr-1.5 align-middle text-lg"></i>วันที่ต้องการเข้าร่วมงาน <span class="text-red-500">*</span>
                        </h3>
                        <div class="space-y-3">
                            <label class="block relative cursor-pointer group active:scale-[0.99] transition-transform">
                                <input type="radio" name="eventDate" value="1.วันที่ 12 กุมภาพันธ์ 2569" class="peer sr-only">
                                <div class="border border-gray-200 rounded-2xl p-4 flex items-center gap-4 transition-all duration-200 ease-in-out bg-white/80 hover:bg-white hover:shadow-lg peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 relative z-20">
                                    <div class="bg-gray-50 p-3 rounded-xl  text-orange-500 shrink-0 flex items-center justify-center">
                                        <i class="fi fi-sr-hospital text-2xl flex items-center justify-center leading-none"></i>
                                    </div>
                                    <div><span class="font-bold text-gray-800 block">12 กุมภาพันธ์ 2569</span><span class="text-xs text-gray-500">วันแห่งสายการแพทย์/โรงพยาบาล/ธุรกิจบริการสุขภาพ(รับคูปอง 3 ใบ)</span></div>
                                    <div class="absolute top-4 right-4 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                                </div>
                            </label>
                            
                            <label class="block relative cursor-pointer group active:scale-[0.99] transition-transform">
                                <input type="radio" name="eventDate" value="2.วันที่ 13 กุมภาพันธ์ 2569" class="peer sr-only">
                                <div class="border border-gray-200 rounded-2xl p-4 flex items-center gap-4 transition-all duration-200 ease-in-out bg-white/80 hover:bg-white hover:shadow-lg peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 relative z-20">
                                    <div class="bg-gray-50 p-3 rounded-xl  text-orange-500 shrink-0 flex items-center justify-center">
                                        <i class="fi fi-sr-microchip text-2xl flex items-center justify-center leading-none"></i>
                                    </div>
                                    <div><span class="font-bold text-gray-800 block">13 กุมภาพันธ์ 2569</span><span class="text-xs text-gray-500">วันแห่งสาย Tech/Data/ นวัตกรรมอาหารและยา/เครื่องมือการแพทย์(รับคูปอง 3 ใบ)</span></div>
                                    <div class="absolute top-4 right-4 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                                </div>
                            </label>
                            
                            <label class="block relative cursor-pointer group active:scale-[0.99] transition-transform">
                                <input type="radio" name="eventDate" value="3.เข้าร่วมทั้ง 2 วัน" class="peer sr-only">
                                <div class="border border-gray-200 rounded-2xl p-4 flex items-center gap-4 transition-all duration-200 ease-in-out bg-white/80 hover:bg-white hover:shadow-lg peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200 relative z-20">
                                    <div class="bg-gray-50 p-3 rounded-xl  text-orange-500 shrink-0 flex items-center justify-center">
                                        <i class="fi fi-sr-calendar-star text-2xl flex items-center justify-center leading-none"></i>
                                    </div>
                                    <div><span class="font-bold text-gray-800 block">เข้าร่วมทั้ง 2 วัน (12-13 กุมภาพันธ์ 2569)</span><span class="text-xs text-gray-500">รับคูปอง 6 ใบ</span></div>
                                    <div class="absolute top-4 right-4 text-orange-500 opacity-0 peer-checked:opacity-100 transition-opacity"><i class="fi fi-sr-check-circle"></i></div>
                                </div>
                            </label>
                        </div>
                    </div>
<div class="mb-6 relative z-20">
    <label class="block text-sm font-semibold text-gray-700 mb-3">
        จุดประสงค์เข้าร่วมงาน (เลือกได้มากกว่า 1 ข้อ) <span class="text-red-500">*</span>
    </label>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
            <div class="checkbox-wrapper-12 mr-3">
                <div class="cbx">
                    <input type="checkbox" id="obj_job" name="objective" value="ค้นหาโอกาสร่วมงาน/สมัครงาน ในตำแหน่งงานที่สนใจ">
                    <label for="obj_job"></label>
                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                </div>
            </div>
            <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">ค้นหาโอกาสร่วมงาน/สมัครงาน ในตำแหน่งงานที่สนใจ</span>
        </label>

        <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
            <div class="checkbox-wrapper-12 mr-3">
                <div class="cbx">
                    <input type="checkbox" id="obj_intern" name="objective" value="ค้นหาแหล่งฝึกงาน/สหกิจ">
                    <label for="obj_intern"></label>
                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                </div>
            </div>
            <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">ค้นหาแหล่งฝึกงาน/สหกิจ</span>
        </label>

        <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
            <div class="checkbox-wrapper-12 mr-3">
                <div class="cbx">
                    <input type="checkbox" id="obj_progress" name="objective" value="มองหาโอกาสความก้าวหน้า">
                    <label for="obj_progress"></label>
                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                </div>
            </div>
            <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">มองหาโอกาสความก้าวหน้า</span>
        </label>

        <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
            <div class="checkbox-wrapper-12 mr-3">
                <div class="cbx">
                    <input type="checkbox" id="obj_study" name="objective" value="ต้องการหาข้อมูลศึกษาต่อ / ทุนการศึกษา">
                    <label for="obj_study"></label>
                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                </div>
            </div>
            <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">ต้องการหาข้อมูลศึกษาต่อ / ทุนการศึกษา</span>
        </label>

        <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
            <div class="checkbox-wrapper-12 mr-3">
                <div class="cbx">
                    <input type="checkbox" id="obj_seminar" name="objective" value="เข้าร่วมฟังสัมมนา/กิจกรรมบนเวที">
                    <label for="obj_seminar"></label>
                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                </div>
            </div>
            <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">เข้าร่วมฟังสัมมนา/กิจกรรมบนเวที</span>
        </label>

        <div class="col-span-1">
            <div class="bg-white rounded-xl border border-gray-200 hover:border-orange-300 transition-all duration-200 p-3 h-full flex flex-col justify-center">
                <label class="flex items-center cursor-pointer group w-full">
                    <div class="checkbox-wrapper-12 mr-3">
                        <div class="cbx">
                            <input type="checkbox" id="obj_other" name="objective" value="Other" onchange="toggleOtherObjective(this)">
                            <label for="obj_other"></label>
                            <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                        </div>
                    </div>
                    <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">อื่น ๆ โปรดระบุ</span>
                </label>
                <input type="text" id="otherObjectiveInput" class="hidden w-full mt-2 text-sm border-b border-gray-300 focus:border-orange-500 outline-none py-1 text-gray-600 placeholder-gray-400 bg-transparent animate-fade-in" placeholder="ระบุจุดประสงค์...">
            </div>
        </div>
    </div>
</div>
                    <div class="flex justify-end pt-4">
                        <button type="button" onclick="nextStep()" class="group bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold py-3.5 px-10 rounded-full shadow-lg transition transform active:scale-95 flex items-center gap-2 relative z-30">
                            ถัดไป <i class="fi fi-sr-arrow-small-right text-xl mt-1"></i>
                        </button>
                    </div>
                </div>

                <div id="step2" class="hidden animate-fade-in relative">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2 border-l-4 border-orange-500 pl-3">
                        ข้อมูลติดต่อ
                    </h2>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700">
                                <i class="fi fi-sr-phone-call text-gray-400 mr-1.5 align-middle text-lg"></i>เบอร์โทร (แสดงผล: 000-0000000) <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fi fi-sr-phone-call absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" name="phone" oninput="formatPhone(this)" class="w-full input-glass rounded-xl p-4 pl-12 text-lg tracking-wider" placeholder="0XX-XXX-XXXX" maxlength="13" required>
                            </div>
                        </div>

                <div class="relative">
                    <label class="block text-sm font-medium mb-1 text-gray-700">
                        <i class="fi fi-sr-envelope text-gray-400 mr-1.5 align-middle text-lg"></i>อีเมล <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <i class="fi fi-sr-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" name="email" id="emailInput" oninput="suggestEmail(this)" autocomplete="off" class="w-full input-glass rounded-xl p-4 pl-12 text-lg" placeholder="ชื่อผู้ใช้@โดเมน" required>
                    </div>
                    <ul id="emailSuggestions" class="absolute z-50 w-full bg-white border border-gray-200 rounded-b-xl shadow-xl hidden mt-1 overflow-hidden"></ul>
                </div>

<div>
            <label class="block text-sm font-medium mb-2 text-gray-700">
                ทราบข่าวจากช่องทางใด (เลือกได้มากกว่า 1 ข้อ)
            </label>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
                    <div class="checkbox-wrapper-12 mr-3">
                        <div class="cbx">
                            <input type="checkbox" id="ch_social" name="channel" value="สื่อสังคมออนไลน์ และเว็บไซต์ข่าว">
                            <label for="ch_social"></label>
                            <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                        </div>
                    </div>
                    <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">สื่อสังคมออนไลน์ และเว็บไซต์ข่าว</span>
                </label>

                <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
                    <div class="checkbox-wrapper-12 mr-3">
                        <div class="cbx">
                            <input type="checkbox" id="ch_print" name="channel" value="หนังสือพิมพ์ / วารสาร / โบว์ชัวร์">
                            <label for="ch_print"></label>
                            <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                        </div>
                    </div>
                    <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">หนังสือพิมพ์ / วารสาร / โบว์ชัวร์</span>
                </label>

                <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
                    <div class="checkbox-wrapper-12 mr-3">
                        <div class="cbx">
                            <input type="checkbox" id="ch_tv" name="channel" value="โทรทัศน์">
                            <label for="ch_tv"></label>
                            <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                        </div>
                    </div>
                    <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">โทรทัศน์</span>
                </label>

                <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
                    <div class="checkbox-wrapper-12 mr-3">
                        <div class="cbx">
                            <input type="checkbox" id="ch_friend" name="channel" value="เพื่อน /ครู / โรงเรียน">
                            <label for="ch_friend"></label>
                            <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                        </div>
                    </div>
                    <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">เพื่อน /ครู / โรงเรียน</span>
                </label>

                <label class="flex items-center p-3 bg-white rounded-xl border border-gray-200 hover:border-orange-300 hover:bg-orange-50 cursor-pointer transition-all duration-200 group h-full">
                    <div class="checkbox-wrapper-12 mr-3">
                        <div class="cbx">
                            <input type="checkbox" id="ch_parent" name="channel" value="ผู้ปกครอง">
                            <label for="ch_parent"></label>
                            <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                        </div>
                    </div>
                    <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">ผู้ปกครอง</span>
                </label>

                <div class="col-span-1 sm:col-span-1">
                    <div class="bg-white rounded-xl border border-gray-200 hover:border-orange-300 transition-all duration-200 p-3 h-full flex flex-col justify-center">
                        <label class="flex items-center cursor-pointer group w-full">
                            <div class="checkbox-wrapper-12 mr-3">
                                <div class="cbx">
                                    <input type="checkbox" id="ch_ot" name="channel" value="Other" onchange="toggleOtherField(this)">
                                    <label for="ch_ot"></label>
                                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                                </div>
                            </div>
                            <span class="text-gray-700 text-sm group-hover:text-orange-700 font-medium">อื่น ๆ โปรดระบุ</span>
                        </label>
                        <input type="text" id="otherInput" class="hidden w-full mt-2 text-sm border-b border-gray-300 focus:border-orange-500 outline-none py-1 text-gray-600 placeholder-gray-400 bg-transparent animate-fade-in" placeholder="ระบุช่องทาง...">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-orange-50 border border-orange-100 rounded-2xl hover:shadow-sm transition-shadow duration-200">
            <label class="flex items-start cursor-pointer gap-3">
                <div class="checkbox-wrapper-12 mt-0.5 shrink-0">
                    <div class="cbx">
                        <input type="checkbox" id="pdpa" name="pdpaConsent" value="Y" required>
                        <label for="pdpa"></label>
                        <svg width="15" height="14" viewBox="0 0 15 14" fill="none"><path d="M2 8.36364L6.23077 12L13 2"></path></svg>
                    </div>
                </div>
                <span class="text-sm text-gray-600 leading-relaxed font-light select-none">
                    ข้าพเจ้ายินยอมให้ทีมงานผู้จัดงานกิจกรรม นำข้อมูลข้อมูลส่วนบุคคลไปใช้เพื่อการลงทะเบียนและกิจกรรมประชาสัมพันธ์ ภายในงานครั้งนี้เท่านั้น <span class="text-red-500 font-bold">*</span>
                </span>
            </label>
        </div>

                    </div>
                    <div class="flex justify-between items-center mt-10 pt-6 border-t border-gray-200">
                        <button type="button" onclick="prevStep()" class="text-gray-500 hover:text-gray-700 font-medium">ย้อนกลับ</button>
                        <button type="submit" id="btnSubmit" class="btn-gradient px-12 py-3.5 rounded-full shadow-lg font-bold flex items-center gap-2"><i class="fi fi-sr-check-circle"></i> ยืนยันลงทะเบียน</button>
                    </div>
                </div>
            </form>

            <div id="successView" class="hidden flex flex-col items-center justify-center py-10 text-center animate-fade-in">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 shadow-inner ring-4 ring-green-50">
                    <i class="fi fi-sr-check-circle text-6xl text-green-600"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-2">ลงทะเบียนสำเร็จ!</h2>
                <p class="text-gray-500 mb-8">ขอบคุณที่ร่วมเป็นส่วนหนึ่งของงาน CRA Job Fair</p>
                <div class="bg-gradient-to-r from-orange-50 to-red-50 p-8 rounded-3xl border border-orange-100 w-full max-w-sm mx-auto shadow-sm">
                    <p class="text-sm text-gray-500 uppercase tracking-widest">User ID</p>
                    <p id="displayUserId" class="text-4xl font-bold text-orange-600 tracking-wider my-2">CV----</p>
                </div>
                
                <div class="mt-6 p-4 bg-white rounded-xl shadow-sm border border-gray-100 inline-block">
                    <img id="displayQrCode" src="" alt="QR Code" class="w-40 h-40 object-contain mx-auto">
                    <p class="text-xs text-gray-400 mt-2">QR Code สำหรับเช็คอิน</p>
                </div>

                <div class="mt-8">
                     <button onclick="goBackToHome()" class="text-orange-600 hover:text-orange-700 font-medium transition active:scale-95">กลับสู่หน้าหลัก (ลงทะเบียนใหม่)</button>
                </div>
            </div>

         </div>
      </div>

  </div>

  <script>
    // [สำคัญ] เอา URL ที่ได้จากการ Deploy (ลงท้ายด้วย /exec) มาใส่ตรงนี้
const API_URL = "https://script.google.com/macros/s/AKfycbxldZnRE3QbH7NEKWLzoqs_cz_osoro40-JP89YjnGuQurGpR7uA1ToaDWrX-NDrKnZQQ/exec";

// ฟังก์ชันกลางสำหรับติดต่อ Google Apps Script
async function callAPI(action, payload) {
    try {
        // แสดง Loading (ถ้าต้องการ) หรือจัดการ UI ให้รู้ว่ากำลังโหลด
        const response = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: action, payload: payload })
            // หมายเหตุ: GAS จะ Redirect 302 อัตโนมัติ fetch จะตามไปเอง
        });
        
        const result = await response.json();
        return result;

    } catch (error) {
        console.error("API Error:", error);
        return { status: 'error', message: 'เชื่อมต่อ Server ไม่ได้ กรุณาลองใหม่' };
    }
}
    var currentStep = 1;

    // --- 1. Functions for Navigation & Reset ---
    
    // ฟังก์ชันเริ่มลงทะเบียน (กดจากหน้า Home)
    function startRegister() {
        resetInternalState(); // ล้างค่าเดิม
        switchPage('register');
    }

// ฟังก์ชันเข้าสู่ระบบ (แก้ไขใหม่: ให้ลิงก์ไปหน้า login.html จริงๆ)
    function startLogin() {
        // ไปที่ไฟล์ login.html โดยตรง
        window.location.href = "login.html";
    }

    // ฟังก์ชันกลับหน้าหลัก (กดจาก Register/Login)
    function goBackToHome() {
        setTimeout(function() {

            try {
                window.top.location.reload(); 
            } catch(e) {
                // Fallback: ถ้า reload ไม่ได้ ให้ switch page กลับ home ธรรมดา
                switchPage('home');
            }
        }, 100);
    }

    // --- 2. Switch Page Logic (เปลี่ยนหน้าจอ) ---
    function switchPage(pageId) {
        // ซ่อนทุกหน้า
        document.querySelectorAll('.page-section').forEach(p => {
            p.classList.remove('active');
            p.style.display = 'none'; // Force hide
        });

        // แสดงหน้าเป้าหมาย
        const target = document.getElementById(pageId);
        if(target) {
            target.style.display = 'block';
            setTimeout(() => target.classList.add('active'), 10);
        }
        window.scrollTo(0,0);
        
        // ถ้ามาหน้า Register ให้โชว์ปุ่มย้อนกลับมุมซ้ายบน
        if(pageId === 'register' && document.getElementById('topBackButton')) {
            document.getElementById('topBackButton').classList.remove('hidden');
        }
    }

    // --- 3. Reset Internal State (เคลียร์ค่าฟอร์มทั้งหมด) ---
    function resetInternalState() {
        const form = document.getElementById('regForm');
        if(form) form.reset(); 
        
        // UI Reset
        if(document.getElementById('successView')) document.getElementById('successView').classList.add('hidden');
        if(document.getElementById('regForm')) document.getElementById('regForm').classList.remove('hidden');
        if(document.getElementById('formStepper')) document.getElementById('formStepper').classList.remove('hidden'); 

        // Reset Stepper
        if(document.getElementById('progressBar')) document.getElementById('progressBar').style.width = '0%';
        const dot2 = document.getElementById('stepDot2');
        if(dot2) {
            dot2.classList.replace('bg-orange-500', 'bg-gray-200');
            dot2.classList.replace('text-white', 'text-gray-400');
        }
        
        if(document.getElementById('step2')) document.getElementById('step2').classList.add('hidden');
        if(document.getElementById('step1')) document.getElementById('step1').classList.remove('hidden');
        
        // Deep Clear Dynamic Fields (ล้างค่าที่ซ่อนอยู่)
        toggleFields(); 
        
        // --- [ส่วนที่เพิ่ม] ล้างช่องกรอก "อื่นๆ" ให้เกลี้ยง ---
        // 1. ล้างช่อง "ช่องทางข่าวสาร"
        const otherChannel = document.getElementById('otherInput');
        if(otherChannel) {
            otherChannel.classList.add('hidden');
            otherChannel.value = '';
        }
        
        // 2. ล้างช่อง "จุดประสงค์เข้าร่วมงาน"
        const otherObj = document.getElementById('otherObjectiveInput');
        if(otherObj) {
            otherObj.classList.add('hidden');
            otherObj.value = '';
        }
        
        // Reset Button
        const btn = document.getElementById('btnSubmit');
        if(btn) {
            btn.disabled = false;
            btn.innerHTML = '<i class="fi fi-sr-check-circle text-lg"></i> ยืนยันลงทะเบียน';
        }

        currentStep = 1;
    }

    // --- 4. Wrapper for Top Button ---
    function navigateTo(page) {
        if(page === 'home') {
            goBackToHome();
        }
    }

    // --- 5. Logic Toggle Fields ---
    function toggleFields() {
        const typeEl = document.querySelector('input[name="userType"]:checked');
        const type = typeEl ? typeEl.value : "";
        const container = document.getElementById('dynamicFields');
        
        container.querySelectorAll('[id^="field-"]').forEach(el => {
            el.classList.add('hidden');
            el.querySelectorAll('input, select').forEach(input => {
                input.value = ''; 
                if(input.type !== 'hidden') input.required = false; 
            });
        });

        // Reset Dropdown Text
        if(document.getElementById('craTypeDisplayText')) {
            document.getElementById('craTypeDisplayText').innerText = '-- เลือกประเภท --';
            document.getElementById('craTypeDisplayText').classList.add('text-gray-500');
            document.getElementById('craTypeDisplayText').classList.remove('text-gray-800', 'font-medium');
        }
        if(document.getElementById('craTypeInput')) document.getElementById('craTypeInput').value = '';

        if(document.getElementById('curriculumTriggerText')) {
            document.getElementById('curriculumTriggerText').innerText = '-- เลือกหลักสูตร --';
            document.getElementById('curriculumTriggerText').classList.add('text-gray-500');
            document.getElementById('curriculumTriggerText').classList.remove('text-gray-800', 'font-medium');
        }
        if(document.getElementById('curriculumInput')) document.getElementById('curriculumInput').value = '';
        
        container.classList.add('hidden');
        if(type) container.classList.remove('hidden');

        if(type.startsWith("1.")) { 
            const f = document.getElementById('field-cra-type');
            if(f) f.classList.remove('hidden');
        } else if(type.startsWith("2.")) { 
            const f1 = document.getElementById('field-institution');
            const f2 = document.getElementById('field-gen-student-info');
            if(f1) { f1.classList.remove('hidden'); f1.querySelector('input').required = true; }
            if(f2) { f2.classList.remove('hidden'); f2.querySelector('input').required = true; f2.querySelector('select').required = true; }
        } else if(type.startsWith("3.") || type.startsWith("4.")) { 
            const f = document.getElementById('field-workplace');
            if(f) { f.classList.remove('hidden'); f.querySelector('input').required = true; }
        }
    }
    
    // --- (Helpers & Dropdowns) ---
    function toggleCRASubFields() {
       const craType = document.getElementById('craTypeInput').value;
       const sID = document.getElementById('field-student-id');
       const curr = document.getElementById('field-curriculum');
       const year = document.getElementById('field-year');
       const dept = document.getElementById('field-department');

       [sID, curr, year, dept].forEach(f => {
           f.classList.add('hidden');
           f.querySelectorAll('input, select').forEach(i => i.required = false);
       });

       if (craType.includes('นักศึกษา')) { 
          sID.classList.remove('hidden'); sID.querySelector('input').required = true;
          curr.classList.remove('hidden'); 
          year.classList.remove('hidden'); year.querySelector('select').required = true;
       } else if (craType !== '') {
          dept.classList.remove('hidden'); dept.querySelector('select').required = true;
       }
    }
// Toggle Other Field Function
    function toggleOtherField(checkbox) {
        const input = document.getElementById('otherInput');
        if (checkbox.checked) {
            input.classList.remove('hidden');
            input.focus();
        } else {
            input.classList.add('hidden');
            input.value = '';
        }
    }
    const craTypeData = [
        { name: "นักศึกษา", icon: "fi-sr-graduation-cap" },
        { name: "อาจารย์และนักวิชาการ", icon: "fi-sr-chalkboard-user" },
        { name: "บุคลากรทางการแพทย์", icon: "fi-ss-stethoscope" },
        { name: "บุคลากร", icon: "fi-sr-id-badge" }
    ];

    function initCRADropdown() {
        const container = document.getElementById('craTypeOptions');
        if(!container) return;
        let html = '';
        craTypeData.forEach(item => {
            html += `
                <div onclick="selectCRAType('${item.name}')" class="flex items-center gap-3 p-3.5 hover:bg-orange-50 cursor-pointer border-b border-gray-100 last:border-0 transition group">
                    <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center shrink-0 group-hover:bg-white transition shadow-sm text-orange-500">
                        <i class="fi ${item.icon} text-lg flex items-center justify-center leading-none"></i>
                    </div>
                    <span class="text-gray-700 font-medium text-sm">${item.name}</span>
                </div>`;
        });
        container.innerHTML = html;
    }

    function toggleCRADropdown() {
        document.getElementById('craTypeOptions').classList.toggle('hidden');
        document.getElementById('craTypeArrow').classList.toggle('rotate-180');
    }

    function selectCRAType(value) {
        document.getElementById('craTypeDisplayText').textContent = value;
        document.getElementById('craTypeDisplayText').classList.remove('text-gray-500');
        document.getElementById('craTypeDisplayText').classList.add('text-gray-800', 'font-medium');
        document.getElementById('craTypeInput').value = value;
        toggleCRADropdown();
        toggleCRASubFields();
    }

    const curriculumData = [
        { name: "แพทยศาสตรบัณฑิต", icon: "med" },
        { name: "พยาบาลศาสตรบัณฑิต", icon: "nurse" },
        { name: "พยาบาลศาสตรบัณฑิต (หลักสูตรนานาชาติ)", icon: "nurse_inter" },
        { name: "พยาบาลศาสตรบัณฑิต รับผู้สำเร็จปริญญาตรีสาขาอื่น", icon: "nurse" },
        { name: "วท.บ. สาขาวิชาฉุกเฉินการแพทย์", icon: "emergency" },
        { name: "วท.บ. สาขาวิชาวิทยาศาสตร์ข้อมูลสุขภาพ", icon: "data" },
        { name: "วท.บ. สาขาวิชารังสีเทคนิค", icon: "radiation" },
        { name: "วท.บ. สาขาวิชาวิทยาศาสตร์การเคลื่อนไหวและสุขภาพ", icon: "move" },
        { name: "วท.บ. สาขาวิชานวัตกรรมวิทยาศาสตร์การแพทย์", icon: "science" },
        { name: "วศ.บ.สาขาวิชาวิศวกรรมชีวการแพทย์", icon: "bioeng" },
        { name: "วท.บ. สาขาวิชาเทคโนโลยีอาหารทางการแพทย์และสุขภาพ", icon: "food" }
    ];

    const icons = {
        med: '<i class="fi fi-sr-stethoscope text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        nurse: '<i class="fi fi-sr-heart text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        nurse_inter: '<i class="fi fi-sr-globe text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        emergency: '<i class="fi fi-sr-ambulance text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        data: '<i class="fi fi-sr-chart-histogram text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        radiation: '<i class="fi fi-sr-radiation text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        move: '<i class="fi fi-sr-running text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        science: '<i class="fi fi-sr-microscope text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        bioeng: '<i class="fi fi-sr-microchip text-xl text-orange-500 flex items-center justify-center leading-none"></i>',
        food: '<i class="fi fi-sr-carrot text-xl text-orange-500 flex items-center justify-center leading-none"></i>'
    };

    function initCurriculumDropdown() {
        const container = document.getElementById('curriculumOptions');
        if(!container) return;
        let html = '';
        curriculumData.forEach(item => {
            const iconHtml = icons[item.icon] || '<i class="fi fi-sr-book-alt text-xl text-gray-400"></i>';
            html += `
                <div onclick="selectCurriculum('${item.name}')" class="flex items-center gap-3 p-3.5 hover:bg-orange-50 cursor-pointer border-b border-gray-100 last:border-0 transition group">
                    <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center shrink-0 group-hover:bg-white transition shadow-sm border border-gray-100 group-hover:border-orange-200">
                        ${iconHtml}
                    </div>
                    <span class="text-gray-700 font-medium text-sm leading-relaxed">${item.name}</span>
                </div>`;
        });
        container.innerHTML = html;
    }

    function toggleCurriculumDropdown() {
        document.getElementById('curriculumOptions').classList.toggle('hidden');
        document.getElementById('curriculumArrow').classList.toggle('rotate-180');
    }

    function selectCurriculum(name) {
        document.getElementById('curriculumTriggerText').textContent = name;
        document.getElementById('curriculumTriggerText').classList.remove('text-gray-500');
        document.getElementById('curriculumTriggerText').classList.add('text-gray-800', 'font-medium');
        document.getElementById('curriculumInput').value = name;
        toggleCurriculumDropdown();
        updateYearOptionsCustom(); 
    }

    function updateYearOptionsCustom() {
       const curr = document.getElementById('curriculumInput').value; 
       const yearSelect = document.getElementById('yearSelect');
       yearSelect.innerHTML = '<option value="">เลือกชั้นปี</option>';
       let maxYear = 4;
       
       if (curr.includes('แพทยศาสตรบัณฑิต')) maxYear = 7;
       else if (curr.includes('รับผู้สำเร็จปริญญาตรีสาขาอื่น')) maxYear = 2; 
       else if (curr.includes('พยาบาล')) maxYear = 4;
       else if (curr === "") maxYear = 0;

       if(maxYear > 0) {
           for (let i = 1; i <= maxYear; i++) {
              let opt = document.createElement('option');
              opt.value = "ปี " + i;
              opt.textContent = "ชั้นปีที่ " + i;
              yearSelect.appendChild(opt);
           }
       }
    }

    document.addEventListener('click', function(e) {
        const currTrigger = document.getElementById('curriculumTrigger');
        const currOptions = document.getElementById('curriculumOptions');
        if (currTrigger && currOptions && !currTrigger.contains(e.target) && !currOptions.contains(e.target) && !currOptions.classList.contains('hidden')) {
            toggleCurriculumDropdown();
        }
        const craTrigger = document.getElementById('craTypeTrigger');
        const craOptions = document.getElementById('craTypeOptions');
        if (craTrigger && craOptions && !craTrigger.contains(e.target) && !craOptions.contains(e.target) && !craOptions.classList.contains('hidden')) {
            toggleCRADropdown();
        }
    });
    
    initCurriculumDropdown();
    initCRADropdown();

function toggleOtherObjective(checkbox) {
    const input = document.getElementById('otherObjectiveInput');
    if (checkbox.checked) {
        input.classList.remove('hidden');
        input.focus();
    } else {
        input.classList.add('hidden');
        input.value = '';
    }
}
    function nextStep() {
        const form = document.forms['regForm'];
        if (!document.querySelector('input[name="objective"]:checked')) {
        Swal.fire({icon: 'warning', title: 'ยังไม่ได้เลือกข้อมูล', text: 'กรุณาเลือกจุดประสงค์เข้าร่วมงานอย่างน้อย 1 ข้อ', confirmButtonColor: '#f97316'}); return;
    }
        if (!form.prefix.value || !form.fname.value || !form.lname.value) { Swal.fire({icon: 'warning', title: 'ข้อมูลไม่ครบ', text: 'กรุณากรอกข้อมูลส่วนตัวให้ครบถ้วน', confirmButtonColor: '#f97316'}); return; }
        const userType = document.querySelector('input[name="userType"]:checked');
        if (!userType) { Swal.fire({icon: 'warning', title: 'ยังไม่ได้เลือกสถานะ', text: 'กรุณาเลือกสถานะของคุณ', confirmButtonColor: '#f97316'}); return; }
        
        if(userType.value.startsWith("1.")) {
             if(!document.getElementById('craTypeInput').value) { Swal.fire({icon: 'warning', title: 'ข้อมูลไม่ครบ', text: 'กรุณาเลือกประเภทใน CRA', confirmButtonColor: '#f97316'}); return; }
             if(document.getElementById('craTypeInput').value.includes("นักศึกษา") && !document.getElementById('curriculumInput').value) { Swal.fire({icon: 'warning', title: 'ข้อมูลไม่ครบ', text: 'กรุณาเลือกหลักสูตร', confirmButtonColor: '#f97316'}); return; }
        }
        if (!document.querySelector('input[name="eventDate"]:checked')) { Swal.fire({icon: 'warning', title: 'ยังไม่ได้เลือกวัน', text: 'กรุณาเลือกวันที่เข้าร่วมงาน', confirmButtonColor: '#f97316'}); return; }

        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.remove('hidden');
        document.getElementById('progressBar').style.width = '100%';
        const dot2 = document.getElementById('stepDot2');
        dot2.classList.replace('bg-gray-200', 'bg-orange-500');
        dot2.classList.replace('text-gray-400', 'text-white');
        currentStep = 2; window.scrollTo(0,0);
    }

    function prevStep() {
        document.getElementById('step2').classList.add('hidden');
        document.getElementById('step1').classList.remove('hidden');
        document.getElementById('progressBar').style.width = '0%';
        const dot2 = document.getElementById('stepDot2');
        dot2.classList.replace('bg-orange-500', 'bg-gray-200');
        dot2.classList.replace('text-white', 'text-gray-400');
        currentStep = 1;
    }

    function formatPhone(input) { input.value = input.value.replace(/\D/g,''); if(input.value.length > 10) input.value = input.value.substring(0,10); if(input.value.length > 6) input.value = input.value.slice(0,3)+"-"+input.value.slice(3,6)+"-"+input.value.slice(6); else if(input.value.length > 3) input.value = input.value.slice(0,3)+"-"+input.value.slice(3); }
function suggestEmail(input) {
      const val = input.value;
      const list = document.getElementById('emailSuggestions');
      const domains = ['@gmail.com', '@cra.ac.th', '@hotmail.com', '@outlook.com'];
      if (!val || val.includes('@')) { list.classList.add('hidden'); return; }
      list.innerHTML = '';
      domains.forEach(d => {
         const li = document.createElement('li');
         li.textContent = val + d;
         li.className = "px-4 py-3 hover:bg-orange-50 cursor-pointer text-sm text-gray-700 border-b border-gray-100 last:border-0";
         li.onclick = () => { input.value = val + d; list.classList.add('hidden'); };
         list.appendChild(li);
      });
      list.classList.remove('hidden');
    }

function handleFormSubmit(e) {
      e.preventDefault();
      const form = document.forms['regForm'];
      const btn = document.getElementById('btnSubmit');
      const originalText = btn.innerHTML;
      
      // เปลี่ยนปุ่มเป็นสถานะโหลด
      btn.innerHTML = '<div class="flex items-center justify-center gap-3"><span class="loader"></span> <span>กำลังตรวจสอบ...</span></div>';
      btn.disabled = true;

      // 1. ดึงข้อมูลช่องทางข่าวสาร (รองรับการพิมพ์ "อื่นๆ")
      let channels = []; 
      document.querySelectorAll('input[name="channel"]:checked').forEach(c => {
          if (c.value === "Other") {
              const otherText = document.getElementById('otherInput').value.trim();
              if(otherText) channels.push("อื่นๆ (" + otherText + ")");
              // ถ้าติ๊กอื่นๆ แต่ไม่กรอก ก็ให้ส่งคำว่า อื่นๆ ไป
              else channels.push("อื่นๆ");
          } else {
              channels.push(c.value);
          }
      });

      // 2. ดึงข้อมูลจุดประสงค์ (รองรับการพิมพ์ "อื่นๆ")
      let objectives = [];
      document.querySelectorAll('input[name="objective"]:checked').forEach(c => {
          if (c.value === "Other") {
              const otherText = document.getElementById('otherObjectiveInput').value.trim();
              if(otherText) objectives.push("อื่นๆ (" + otherText + ")");
              else objectives.push("อื่นๆ");
          } else {
              objectives.push(c.value);
          }
      });

      // 3. [สำคัญ] ตรวจสอบวันที่เลือก เพื่อสร้างรหัสคูปองให้ถูกวัน (12, 13, หรือทั้งคู่)
      const dateOption = document.querySelector('input[name="eventDate"]:checked').value;
      let dateCodes = [];
      let dateText = "";

      if (dateOption.startsWith("1.")) {
          dateCodes = ["12"]; // มาวันที่ 12 -> ได้คูปองรหัส 12
          dateText = "12 กุมภาพันธ์ 2569";
      } else if (dateOption.startsWith("2.")) {
          dateCodes = ["13"]; // มาวันที่ 13 -> ได้คูปองรหัส 13
          dateText = "13 กุมภาพันธ์ 2569";
      } else if (dateOption.startsWith("3.")) {
          dateCodes = ["12", "13"]; // มา 2 วัน -> ได้คูปองทั้งรหัส 12 และ 13
          dateText = "เข้าร่วมทั้ง 2 วัน";
      }

      // ตัดเลขนำหน้าประเภทผู้ใช้ (เช่น "1.นักศึกษา" -> "นักศึกษา")
      const userTypeVal = document.querySelector('input[name="userType"]:checked').value.replace(/^\d+\./, '');

      // 4. รวบรวมข้อมูลเป็น Object เดียวเตรียมส่ง
// 4. สร้าง Object ข้อมูลเตรียมส่ง
      const formData = {
         prefix: form.prefix.value, 
         fname: form.fname.value, 
         lname: form.lname.value,
         userType: userTypeVal,
         craType: document.getElementById('craTypeInput').value,
         institution: form.institution ? form.institution.value : "",
         workplace: form.workplace ? form.workplace.value : "",
         studentId: form.studentId ? form.studentId.value : "",
         curriculum: document.getElementById('curriculumInput').value || form.genCurriculum ? form.genCurriculum.value : "",
         year: form.year.value || (form.genYear ? form.genYear.value : ""),
         department: form.department ? form.department.value : "",
         email: form.email.value, 
         phone: form.phone.value,
         channel: channels.join(', '),
         selectedDates: JSON.stringify(dateCodes), 
         dateTextForSheet: dateText, 
         objective: objectives.join(', '),
         pdpa: form.pdpaConsent.checked ? "ยินยอม" : ""
      };

      // 5. ส่งข้อมูลผ่าน API
      const res = await callAPI('register', formData);

      // 6. ตรวจสอบผลลัพธ์
      if (res.status === 'success') {
          // ซ่อนฟอร์ม -> โชว์หน้าสำเร็จ
          document.getElementById('regForm').classList.add('hidden');
          document.getElementById('formStepper').classList.add('hidden'); 
          document.getElementById('successView').classList.remove('hidden');
          
          // แสดง User ID และ QR Code
          document.getElementById('displayUserId').innerText = res.userId;
          
          const topBackBtn = document.getElementById('topBackButton');
          if(topBackBtn) topBackBtn.classList.add('hidden');
          
          document.getElementById('displayQrCode').src = "https://quickchart.io/qr?text=" + res.userId + "&size=200";
      } else {
          // กรณี Error
          Swal.fire({icon: 'error', title: 'แจ้งเตือน', text: res.message, confirmButtonColor: '#ef4444'});
          btn.innerHTML = originalText; 
          btn.disabled = false;
      }
    }
</script>
</body>
</html>
